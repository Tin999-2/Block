<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ジオキャッシング・ブロック崩し</title>
    <style>
        body { background: #222; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; margin: 0; color: white; font-family: sans-serif; overflow: hidden; }
        canvas { border: 2px solid #fff; background: #000; box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        .info { text-align: center; margin-bottom: 10px; }
        /* 座標表示のスタイル */
        #result-screen {
            display: none;
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            border: 3px solid #2ecc71;
            padding: 20px;
            text-align: center;
            border-radius: 10px;
            z-index: 100;
        }
        .coord { font-family: monospace; font-size: 24px; color: #2ecc71; margin-top: 10px; }
    </style>
</head>
<body>

    <div class="info">
        <h2>Mission: ブロックをすべて壊せ！</h2>
        <p>マウス（または指）でパドルを操作してください</p>
    </div>

    <canvas id="gameCanvas" width="480" height="320"></canvas>

    <div id="result-screen">
        <h2 style="color: #2ecc71;">CLEAR!!</h2>
        <p>最終座標を見つけた：</p>
        <div class="coord">N 35 45.567<br>E 139 45.687</div>
        <button onclick="location.reload()" style="margin-top:15px; padding:10px;">もう一度遊ぶ</button>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        let ballRadius = 8;
        let x = canvas.width / 2;
        let y = canvas.height - 30;
        let dx = 3;
        let dy = -3;
        
        let paddleHeight = 10;
        let paddleWidth = 75;
        let paddleX = (canvas.width - paddleWidth) / 2;

        // ブロックの設定（テスト用に少なく設定しています。増やす場合は数値を調整してください）
        let brickRowCount = 3;
        let brickColumnCount = 5;
        let brickWidth = 75;
        let brickHeight = 20;
        let brickPadding = 10;
        let brickOffsetTop = 30;
        let brickOffsetLeft = 30;

        let totalBricks = brickRowCount * brickColumnCount;
        let clearedBricks = 0;
        let isGameOver = false;

        let bricks = [];
        for(let c=0; c<brickColumnCount; c++) {
            bricks[c] = [];
            for(let r=0; r<brickRowCount; r++) {
                bricks[c][r] = { x: 0, y: 0, status: 1 };
            }
        }

        document.addEventListener("mousemove", mouseMoveHandler, false);
        document.addEventListener("touchmove", touchMoveHandler, {passive: false});

        function mouseMoveHandler(e) {
            let relativeX = e.clientX - canvas.offsetLeft;
            if(relativeX > 0 && relativeX < canvas.width) {
                paddleX = relativeX - paddleWidth / 2;
            }
        }

        function touchMoveHandler(e) {
            e.preventDefault();
            let touch = e.touches[0];
            let relativeX = touch.clientX - canvas.
